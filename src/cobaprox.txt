#include <Arduino.h>

double eqPv1(double lux);
bool isPv1Dirty(double lux, double VReal);
double eqPv0(double lux);
bool isPv0Dirty(double lux, double VReal);

void setup()
{
	Serial.begin(115200);
	// Serial2.begin(115200);
}
double lux = 0;
double v;
void loop()
{
	Serial.print("lux: ");
	Serial.println(lux);
	Serial.print("v eq: ");
	Serial.println(eqPv1(lux));
	delay(1000);
}

void serialEvent()
{
	switch (Serial.read())
	{
	case 'I':
		lux = Serial.parseFloat();
		break;
	}
}

bool isPv1Dirty(double lux, double VReal)
{
	bool isDirty;
	double resV = eqPv1(lux);
	if ((resV - (resV * 0.2)) > VReal)
		isDirty = true;
	else
		isDirty = false;
	return isDirty;
}

double eqPv1(double lux)
{
	double eqLux = log(lux);
	double res = -0.189 * pow(eqLux, 2) + 4.1348 * eqLux - 2.4183;
	return res;
}

bool isPv0Dirty(double lux, double VReal)
{
	bool isDirty;
	double resV = eqPv0(lux);
	if ((resV - (resV * 0.2)) > VReal)
		isDirty = true;
	else
		isDirty = false;
	return isDirty;
}

double eqPv0(double lux)
{
	double eqLux = log(lux);
	double res = -0.172 * pow(eqLux, 2) + 4.08 * eqLux - 3.758;
	return res;
}